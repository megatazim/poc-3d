define(["./defaultValue-6195d6e4","./Ellipsoid-9d24693d","./ArcType-198c1070","./arrayRemoveDuplicates-a80848e1","./buildModuleUrl-89a61082","./Cartesian3-6ab6e817","./Color-7716e146","./ComponentDatatype-9e683007","./Check-d771f3f9","./oneTimeWarning-264f08dd","./GeometryAttribute-b7129781","./GeometryAttributes-bc1c2f3f","./IndexDatatype-7f829734","./Math-77022010","./PolylinePipeline-0d83acd5","./PrimitiveType-5db31a9b","./VertexFormat-8dc15345","./Cartographic-84b54204","./FeatureDetection-d5e675a3","./defer-a21481c0","./Rectangle-f1a1bbf0","./Event-8b63693e","./RuntimeError-3afc2b48","./WebGLConstants-92042d9e","./Cartesian4-da892aa1","./EllipsoidGeodesic-4e69d466","./EllipsoidRhumbLine-7f7a0363","./IntersectionTests-0125ff6b","./Plane-588042d8"],(function(e,t,o,r,a,n,i,l,s,p,c,d,u,h,f,y,m,v,w,_,g,b,L,D,E,A,P,x,T){"use strict";var k=[];function C(e,t,o,r,a){var n=k;n.length=a;var l,s=o.red,p=o.green,c=o.blue,d=o.alpha,u=r.red,h=r.green,f=r.blue,y=r.alpha;if(i.e.equals(o,r)){for(l=0;l<a;l++)n[l]=i.e.clone(o);return n}var m=(u-s)/a,v=(h-p)/a,w=(f-c)/a,_=(y-d)/a;for(l=0;l<a;l++)n[l]=new i.e(s+l*m,p+l*v,c+l*w,d+l*_);return n}function S(r){var a=(r=e.u(r,e.u.EMPTY_OBJECT)).positions,l=r.colors,c=e.u(r.width,1),d=e.u(r.hMax,-1),u=e.u(r.colorsPerVertex,!1);if(!e.e(a)||a.length<2)throw new s.t("At least two positions are required.");if("number"!=typeof c)throw new s.t("width must be a number");if(e.e(l)&&(u&&l.length<a.length||!u&&l.length<a.length-1))throw new s.t("colors has an invalid length.");this._positions=a,this._colors=l,this._width=c,this._hMax=d,this._colorsPerVertex=u,this._dist=r.dist,this._period=r.period,this._vertexFormat=m.n.clone(e.u(r.vertexFormat,m.n.DEFAULT)),this._followSurface=e.u(r.followSurface,!0),e.e(r.followSurface)&&(function(t,o){if(!e.e(t)||!e.e(o))throw new s.t("identifier and message are required.");p.e(t,o)}("PolylineGeometry.followSurface","PolylineGeometry.followSurface is deprecated and will be removed in SuperMap3D. Use PolylineGeometry.arcType instead."),r.arcType=r.followSurface?o.L.GEODESIC:o.L.NONE),this._arcType=e.u(r.arcType,o.L.GEODESIC),this._followSurface=this._arcType!==o.L.NONE,this._granularity=e.u(r.granularity,h.e.RADIANS_PER_DEGREE),this._ellipsoid=t.t.clone(e.u(r.ellipsoid,t.t.WGS84)),this._workerName="createPolylineGeometry";var f=1+a.length*n.o.packedLength;f+=e.e(l)?1+l.length*i.e.packedLength:1,this.packedLength=f+t.t.packedLength+m.n.packedLength+4+2}S.pack=function(o,r,a){if(!e.e(o))throw new s.t("value is required");if(!e.e(r))throw new s.t("array is required");a=e.u(a,0);var l,p=o._positions,c=p.length;for(r[a++]=c,l=0;l<c;++l,a+=n.o.packedLength)n.o.pack(p[l],r,a);var d=o._colors;for(c=e.e(d)?d.length:0,r[a++]=c,l=0;l<c;++l,a+=i.e.packedLength)i.e.pack(d[l],r,a);return t.t.pack(o._ellipsoid,r,a),a+=t.t.packedLength,m.n.pack(o._vertexFormat,r,a),a+=m.n.packedLength,r[a++]=o._width,r[a++]=o._colorsPerVertex?1:0,r[a++]=o._arcType,r[a++]=o._granularity,r[a++]=o._hMax,r[a++]=o._dist,r[a]=o._period,r};var F=t.t.clone(t.t.UNIT_SPHERE),G=new m.n,O={positions:void 0,colors:void 0,ellipsoid:F,vertexFormat:G,width:void 0,colorsPerVertex:void 0,arcType:void 0,granularity:void 0};S.unpack=function(o,r,a){if(!e.e(o))throw new s.t("array is required");r=e.u(r,0);var l,p=o[r++],c=new Array(p);for(l=0;l<p;++l,r+=n.o.packedLength)c[l]=n.o.unpack(o,r);var d=(p=o[r++])>0?new Array(p):void 0;for(l=0;l<p;++l,r+=i.e.packedLength)d[l]=i.e.unpack(o,r);var u=t.t.unpack(o,r,F);r+=t.t.packedLength;var h=m.n.unpack(o,r,G);r+=m.n.packedLength;var f=o[r++],y=1===o[r++],v=o[r++],w=o[r++],_=o[r++],g=1==o[r++],b=o[r];return e.e(a)?(a._positions=c,a._colors=d,a._ellipsoid=t.t.clone(u,a._ellipsoid),a._vertexFormat=m.n.clone(h,a._vertexFormat),a._width=f,a._colorsPerVertex=y,a._arcType=v,a._granularity=w,a._hMax=_,a._dist=g,a._period=b,a):(O.positions=c,O.colors=d,O.width=f,O.colorsPerVertex=y,O.arcType=v,O.granularity=w,O.hMax=_,O.dist=g,O.period=b,new S(O))};var M=new n.o,I=new n.o,R=new n.o,N=new n.o;return S.createGeometry=function(t){var s,p,m,v=t._width,w=t._hMax,_=t._vertexFormat,g=t._colors,b=t._colorsPerVertex,L=t._arcType,D=t._granularity,E=t._ellipsoid,A=t._dist,P=t._period,x=r.D(t._positions,n.o.equalsEpsilon),T=x.length;if(!(T<2||v<=0)){if(L===o.L.GEODESIC||L===o.L.RHUMB){var S,F;L===o.L.GEODESIC?(S=h.e.chordLength(D,E.maximumRadius),F=f.m.numberOfPoints):(S=D,F=f.m.numberOfPointsRhumbLine);var G=f.m.extractHeights(x,E);if(e.e(g)){var O=1;for(s=0;s<T-1;++s)O+=F(x[s],x[s+1],S);var B=new Array(O),U=0;for(s=0;s<T-1;++s){var V=x[s],q=x[s+1],W=g[s],H=F(V,q,S);if(b&&s<O){var Y=C(0,0,W,g[s+1],H),z=Y.length;for(p=0;p<z;++p)B[U++]=Y[p]}else for(p=0;p<H;++p)B[U++]=i.e.clone(W)}B[U]=i.e.clone(g[g.length-1]),g=B,k.length=0}x=L===o.L.GEODESIC?f.m.generateCartesianArc({positions:x,minDistance:S,ellipsoid:E,height:G,hMax:w}):f.m.generateCartesianRhumbArc({positions:x,granularity:S,ellipsoid:E,height:G})}var J,j=4*(T=x.length)-4,K=new Float64Array(3*j),Q=new Float64Array(3*j),X=new Float64Array(3*j),Z=new Float32Array(2*j),$=_.st?new Float32Array(2*j):void 0,ee=e.e(g)?new Uint8Array(4*j):void 0,te=A?new Float32Array(3*j):void 0,oe=0,re=0,ae=0,ne=0,ie=0,le=0;for(p=0;p<T;++p){var se,pe;0===p?(J=M,n.o.subtract(x[0],x[1],J),n.o.add(x[0],J,J)):J=x[p-1],n.o.clone(J,R),n.o.clone(x[p],I),p===T-1?(J=M,n.o.subtract(x[T-1],x[T-2],J),n.o.add(x[T-1],J,J)):J=x[p+1],n.o.clone(J,N),e.e(ee)&&(se=0===p||b?g[p]:g[p-1],p!==T-1&&(pe=g[p]));var ce=p===T-1?2:4;for(m=0===p?2:0;m<ce;++m){n.o.pack(I,K,oe),n.o.pack(R,Q,oe),n.o.pack(N,X,oe),oe+=3;var de=m-2<0?-1:1,ue=m%2*2-1,he=ue*p/T;if(Z[re++]=w>0?he:ue,Z[re++]=de*v,_.st&&($[ae++]=p/(T-1),$[ae++]=Math.max(Z[re-2],0)),e.e(ee)){var fe=m<2?se:pe;ee[ne++]=i.e.floatToByte(fe.red),ee[ne++]=i.e.floatToByte(fe.green),ee[ne++]=i.e.floatToByte(fe.blue),ee[ne++]=i.e.floatToByte(fe.alpha)}A&&(te[3*ie]=le,ie++)}le+=n.o.distance(J,x[p])}if(A){var ye=le,me=Math.random()*(P>0?P:ye);for(p=0;p<j;p++)te[3*p+1]=ye,te[3*p+2]=me}var ve=new d.a;ve.position=new c.o({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:K}),ve.prevPosition=new c.o({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:Q}),ve.nextPosition=new c.o({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:X}),ve.expandAndWidth=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:Z}),_.st&&(ve.st=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:$})),e.e(ee)&&(ve.color=new c.o({componentDatatype:l.ComponentDatatype.UNSIGNED_BYTE,componentsPerAttribute:4,values:ee,normalize:!0})),A&&(ve.dist=new c.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:te}));var we=u.IndexDatatype.createTypedArray(j,6*T-6),_e=0,ge=0,be=T-1;for(p=0;p<be;++p)we[ge++]=_e,we[ge++]=_e+2,we[ge++]=_e+1,we[ge++]=_e+1,we[ge++]=_e+2,we[ge++]=_e+3,_e+=4;return new c.I({attributes:ve,indices:we,primitiveType:y._0x1da42a.TRIANGLES,boundingSphere:a.i.fromPoints(x),geometryType:c.Me.POLYLINES})}},function(o,r){return e.e(r)&&(o=S.unpack(o,r)),o._ellipsoid=t.t.clone(o._ellipsoid),S.createGeometry(o)}}));
