define(["exports","./AttributeCompression-f1ba21d8","./Ellipsoid-9d24693d","./Cartesian3-6ab6e817","./Check-d771f3f9","./defaultValue-6195d6e4","./Math-77022010","./buildModuleUrl-89a61082","./Cartesian4-da892aa1","./Cartographic-84b54204","./ComponentDatatype-9e683007","./EncodedCartesian3-aa410950","./GeometryAttribute-b7129781","./IndexDatatype-7f829734","./IntersectionTests-0125ff6b","./FeatureDetection-d5e675a3","./PrimitiveType-5db31a9b","./Plane-588042d8"],(function(e,t,r,i,a,o,n,s,u,p,l,v,y,c,m,f,d,h){"use strict";var b=new i.o,w=new i.o,g=new i.o;function x(e,t,s,u,p){var l,v,y,c,m,f,d,h;if(a.o.defined("point",e),a.o.defined("p0",t),a.o.defined("p1",s),a.o.defined("p2",u),o.e(p)||(p=new i.o),o.e(t.z)){if(i.o.equalsEpsilon(e,t,n.e.EPSILON14))return i.o.clone(i.o.UNIT_X,p);if(i.o.equalsEpsilon(e,s,n.e.EPSILON14))return i.o.clone(i.o.UNIT_Y,p);if(i.o.equalsEpsilon(e,u,n.e.EPSILON14))return i.o.clone(i.o.UNIT_Z,p);l=i.o.subtract(s,t,b),v=i.o.subtract(u,t,w),y=i.o.subtract(e,t,g),c=i.o.dot(l,l),m=i.o.dot(l,v),f=i.o.dot(l,y),d=i.o.dot(v,v),h=i.o.dot(v,y)}else{if(r.o.equalsEpsilon(e,t,n.e.EPSILON14))return i.o.clone(i.o.UNIT_X,p);if(r.o.equalsEpsilon(e,s,n.e.EPSILON14))return i.o.clone(i.o.UNIT_Y,p);if(r.o.equalsEpsilon(e,u,n.e.EPSILON14))return i.o.clone(i.o.UNIT_Z,p);l=r.o.subtract(s,t,b),v=r.o.subtract(u,t,w),y=r.o.subtract(e,t,g),c=r.o.dot(l,l),m=r.o.dot(l,v),f=r.o.dot(l,y),d=r.o.dot(v,v),h=r.o.dot(v,y)}p.y=d*f-m*h,p.z=c*h-m*f;var x=c*d-m*m;return 0!==p.y&&(p.y/=x),0!==p.z&&(p.z/=x),p.x=1-p.y-p.z,p}var T={calculateACMR:function(e){var t=(e=o.u(e,o.u.EMPTY_OBJECT)).indices,r=e.maximumIndex,i=o.u(e.cacheSize,24);if(!o.e(t))throw new a.t("indices is required.");var n=t.length;if(n<3||n%3!=0)throw new a.t("indices length must be a multiple of three.");if(r<=0)throw new a.t("maximumIndex must be greater than zero.");if(i<3)throw new a.t("cacheSize must be greater than two.");if(!o.e(r)){r=0;for(var s=0,u=t[s];s<n;)u>r&&(r=u),u=t[++s]}for(var p=[],l=0;l<r+1;l++)p[l]=0;for(var v=i+1,y=0;y<n;++y)v-p[t[y]]>i&&(p[t[y]]=v,++v);return(v-i+1)/(n/3)}};T.tipsify=function(e){var t,r=(e=o.u(e,o.u.EMPTY_OBJECT)).indices,i=e.maximumIndex,n=o.u(e.cacheSize,24);function s(e,r,i,a,o,n,s){for(var u,p=-1,l=-1,v=0;v<i.length;){var y=i[v];a[y].numLiveTriangles&&(u=0,o-a[y].timeStamp+2*a[y].numLiveTriangles<=r&&(u=o-a[y].timeStamp),(u>l||-1===l)&&(l=u,p=y)),++v}return-1===p?function(e,r,i,a){for(;r.length>=1;){var o=r[r.length-1];if(r.splice(r.length-1,1),e[o].numLiveTriangles>0)return o}for(;t<a;){if(e[t].numLiveTriangles>0)return++t-1;++t}return-1}(a,n,0,s):p}if(!o.e(r))throw new a.t("indices is required.");var u=r.length;if(u<3||u%3!=0)throw new a.t("indices length must be a multiple of three.");if(i<=0)throw new a.t("maximumIndex must be greater than zero.");if(n<3)throw new a.t("cacheSize must be greater than two.");var p=0,l=0,v=r[l],y=u;if(o.e(i))p=i+1;else{for(;l<y;)v>p&&(p=v),v=r[++l];if(-1===p)return 0;++p}var c,m=[];for(c=0;c<p;c++)m[c]={numLiveTriangles:0,timeStamp:0,vertexTriangles:[]};l=0;for(var f=0;l<y;)m[r[l]].vertexTriangles.push(f),++m[r[l]].numLiveTriangles,m[r[l+1]].vertexTriangles.push(f),++m[r[l+1]].numLiveTriangles,m[r[l+2]].vertexTriangles.push(f),++m[r[l+2]].numLiveTriangles,++f,l+=3;var d=0,h=n+1;t=1;var b,w,g,x,T=[],A=[],I=0,S=[],P=u/3,N=[];for(c=0;c<P;c++)N[c]=!1;for(;-1!==d;){T=[],x=(w=m[d]).vertexTriangles.length;for(var E=0;E<x;++E)if(!N[f=w.vertexTriangles[E]]){N[f]=!0,l=f+f+f;for(var O=0;O<3;++O)g=r[l],T.push(g),A.push(g),S[I]=g,++I,--(b=m[g]).numLiveTriangles,h-b.timeStamp>n&&(b.timeStamp=h,++h),++l}d=s(0,n,T,m,h,A,p)}return S};var A={};function I(e,t,r,i,a){e[t++]=r,e[t++]=i,e[t++]=i,e[t++]=a,e[t++]=a,e[t]=r}function S(e){var t={};for(var r in e)if(e.hasOwnProperty(r)&&o.e(e[r])&&o.e(e[r].values)){var i=e[r];t[r]=new y.o({componentDatatype:i.componentDatatype,componentsPerAttribute:i.componentsPerAttribute,normalize:i.normalize,values:[]})}return t}function P(e,t,r){for(var i in t)if(t.hasOwnProperty(i)&&o.e(t[i])&&o.e(t[i].values))for(var a=t[i],n=0;n<a.componentsPerAttribute;++n)e[i].values.push(a.values[r*a.componentsPerAttribute+n])}A.toWireframe=function(e){if(!o.e(e))throw new a.t("geometry is required.");var t=e.indices;if(o.e(t)){switch(e.primitiveType){case d._0x1da42a.TRIANGLES:e.indices=function(e){for(var t=e.length,r=t/3*6,i=c.IndexDatatype.createTypedArray(t,r),a=0,o=0;o<t;o+=3,a+=6)I(i,a,e[o],e[o+1],e[o+2]);return i}(t);break;case d._0x1da42a.TRIANGLE_STRIP:e.indices=function(e){var t=e.length;if(t>=3){var r=6*(t-2),i=c.IndexDatatype.createTypedArray(t,r);I(i,0,e[0],e[1],e[2]);for(var a=6,o=3;o<t;++o,a+=6)I(i,a,e[o-1],e[o],e[o-2]);return i}return new Uint16Array}(t);break;case d._0x1da42a.TRIANGLE_FAN:e.indices=function(e){if(e.length>0){for(var t=e.length-1,r=6*(t-1),i=c.IndexDatatype.createTypedArray(t,r),a=e[0],o=0,n=1;n<t;++n,o+=6)I(i,o,a,e[n],e[n+1]);return i}return new Uint16Array}(t);break;default:throw new a.t("geometry.primitiveType must be TRIANGLES, TRIANGLE_STRIP, or TRIANGLE_FAN.")}e.primitiveType=d._0x1da42a.LINES}return e},A.createLineSegmentsForVectors=function(e,t,r){if(t=o.u(t,"normal"),!o.e(e))throw new a.t("geometry is required.");if(!o.e(e.attributes.position))throw new a.t("geometry.attributes.position is required.");if(!o.e(e.attributes[t]))throw new a.t("geometry.attributes must have an attribute with the same name as the attributeName parameter, "+t+".");r=o.u(r,1e4);for(var i=e.attributes.position.values,n=e.attributes[t].values,u=i.length,p=new Float64Array(2*u),v=0,c=0;c<u;c+=3)p[v++]=i[c],p[v++]=i[c+1],p[v++]=i[c+2],p[v++]=i[c]+n[c]*r,p[v++]=i[c+1]+n[c+1]*r,p[v++]=i[c+2]+n[c+2]*r;var m,f=e.boundingSphere;return o.e(f)&&(m=new s.i(f.center,f.radius+r)),new y.I({attributes:{position:new y.o({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:p})},primitiveType:d._0x1da42a.LINES,boundingSphere:m})},A.createAttributeLocations=function(e){if(!o.e(e))throw new a.t("geometry is required.");var t,r=["position","positionHigh","positionLow","position3DHigh","position3DLow","position2DHigh","position2DLow","pickColor","normal","st","tangent","bitangent","extrudeDirection","compressedAttributes"],i=e.attributes,n={},s=0,u=r.length;for(t=0;t<u;++t){var p=r[t];o.e(i[p])&&(n[p]=s++)}for(var l in i)i.hasOwnProperty(l)&&!o.e(n[l])&&(n[l]=s++);return n},A.reorderForPreVertexCache=function(e){if(!o.e(e))throw new a.t("geometry is required.");var t=y.I.computeNumberOfVertices(e),r=e.indices;if(o.e(r)){for(var i=new Int32Array(t),n=0;n<t;n++)i[n]=-1;for(var s,u=r,p=u.length,v=c.IndexDatatype.createTypedArray(t,p),m=0,f=0,d=0;m<p;)-1!==(s=i[u[m]])?v[f]=s:(i[s=u[m]]=d,v[f]=d,++d),++m,++f;e.indices=v;var h=e.attributes;for(var b in h)if(h.hasOwnProperty(b)&&o.e(h[b])&&o.e(h[b].values)){for(var w=h[b],g=w.values,x=0,T=w.componentsPerAttribute,A=l.ComponentDatatype.createTypedArray(w.componentDatatype,d*T);x<t;){var I=i[x];if(-1!==I)for(var S=0;S<T;S++)A[T*I+S]=g[T*x+S];++x}w.values=A}}return e},A.reorderForPostVertexCache=function(e,t){if(!o.e(e))throw new a.t("geometry is required.");var r=e.indices;if(e.primitiveType===d._0x1da42a.TRIANGLES&&o.e(r)){for(var i=r.length,n=0,s=0;s<i;s++)r[s]>n&&(n=r[s]);e.indices=T.tipsify({indices:r,maximumIndex:n,cacheSize:t})}return e},A.fitToUnsignedShortIndices=function(e){if(!o.e(e))throw new a.t("geometry is required.");if(o.e(e.indices)&&e.primitiveType!==d._0x1da42a.TRIANGLES&&e.primitiveType!==d._0x1da42a.LINES&&e.primitiveType!==d._0x1da42a.POINTS)throw new a.t("geometry.primitiveType must equal to PrimitiveType.TRIANGLES, PrimitiveType.LINES, or PrimitiveType.POINTS.");var t=[],r=y.I.computeNumberOfVertices(e);if(o.e(e.indices)&&r>=n.e.SIXTY_FOUR_KILOBYTES){var i,s=[],u=[],p=0,l=S(e.attributes),v=e.indices,c=v.length;e.primitiveType===d._0x1da42a.TRIANGLES?i=3:e.primitiveType===d._0x1da42a.LINES?i=2:e.primitiveType===d._0x1da42a.POINTS&&(i=1);for(var m=0;m<c;m+=i){for(var f=0;f<i;++f){var h=v[m+f],b=s[h];o.e(b)||(b=p++,s[h]=b,P(l,e.attributes,h)),u.push(b)}p+i>=n.e.SIXTY_FOUR_KILOBYTES&&(t.push(new y.I({attributes:l,indices:u,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV})),s=[],u=[],p=0,l=S(e.attributes))}0!==u.length&&t.push(new y.I({attributes:l,indices:u,primitiveType:e.primitiveType,boundingSphere:e.boundingSphere,boundingSphereCV:e.boundingSphereCV}))}else t.push(e);return t};var N=new i.o,E=new p.a;A.projectTo2D=function(e,t,r,n,u){if(!o.e(e))throw new a.t("geometry is required.");if(!o.e(t))throw new a.t("attributeName is required.");if(!o.e(r))throw new a.t("attributeName3D is required.");if(!o.e(n))throw new a.t("attributeName2D is required.");if(!o.e(e.attributes[t]))throw new a.t("geometry must have attribute matching the attributeName argument: "+t+".");if(e.attributes[t].componentDatatype!==l.ComponentDatatype.DOUBLE)throw new a.t("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var p=e.attributes[t],v=(u=o.e(u)?u:new s.n).ellipsoid,c=p.values,m=new Float64Array(c.length),f=0,d=0;d<c.length;d+=3){var h=i.o.fromArray(c,d,N),b=v.cartesianToCartographic(h,E);if(!o.e(b))throw new a.t("Could not project point ("+h.x+", "+h.y+", "+h.z+") to 2D.");var w=u.project(b,N);m[f++]=w.x,m[f++]=w.y,m[f++]=w.z}return e.attributes[r]=p,e.attributes[n]=new y.o({componentDatatype:l.ComponentDatatype.DOUBLE,componentsPerAttribute:3,values:m}),delete e.attributes[t],e};var O={high:0,low:0};A.encodeAttribute=function(e,t,r,i){if(!o.e(e))throw new a.t("geometry is required.");if(!o.e(t))throw new a.t("attributeName is required.");if(!o.e(r))throw new a.t("attributeHighName is required.");if(!o.e(i))throw new a.t("attributeLowName is required.");if(!o.e(e.attributes[t]))throw new a.t("geometry must have attribute matching the attributeName argument: "+t+".");if(e.attributes[t].componentDatatype!==l.ComponentDatatype.DOUBLE)throw new a.t("The attribute componentDatatype must be ComponentDatatype.DOUBLE.");for(var n=e.attributes[t],s=n.values,u=s.length,p=new Float32Array(u),c=new Float32Array(u),m=0;m<u;++m)v.i.encode(s[m],O),p[m]=O.high,c[m]=O.low;var f=n.componentsPerAttribute;return e.attributes[r]=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:f,values:p}),e.attributes[i]=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:f,values:c}),delete e.attributes[t],e};var L=new i.o;function D(e,t){if(o.e(t))for(var r=t.values,a=r.length,n=0;n<a;n+=3)i.o.unpack(r,n,L),d.y.multiplyByPoint(e,L,L),i.o.pack(L,r,n)}function z(e,t){if(o.e(t))for(var r=t.values,a=r.length,n=0;n<a;n+=3)i.o.unpack(r,n,L),f.p.multiplyByVector(e,L,L),L=i.o.normalize(L,L),i.o.pack(L,r,n)}var _=new d.y,q=new f.p;A.transformToWorldCoordinates=function(e){if(!o.e(e))throw new a.t("instance is required.");var t=e.modelMatrix;if(d.y.equals(t,d.y.IDENTITY))return e;var r=e.geometry.attributes;D(t,r.position),D(t,r.prevPosition),D(t,r.nextPosition),(o.e(r.normal)||o.e(r.tangent)||o.e(r.bitangent))&&(d.y.inverse(t,_),d.y.transpose(_,_),d.y.getRotation(_,q),z(q,r.normal),z(q,r.tangent),z(q,r.bitangent));var i=e.geometry.boundingSphere;return o.e(i)&&(e.geometry.boundingSphere=s.i.transform(i,t,i)),e.modelMatrix=d.y.clone(d.y.IDENTITY),e};var C=new i.o;function R(e,t){var r,n,u,p,v=e.length,m=e[0].modelMatrix,f=o.e(e[0][t].indices),h=e[0][t].primitiveType;for(n=1;n<v;++n){if(!d.y.equals(e[n].modelMatrix,m))throw new a.t("All instances must have the same modelMatrix.");if(o.e(e[n][t].indices)!==f)throw new a.t("All instance geometries must have an indices or not have one.");if(e[n][t].primitiveType!==h)throw new a.t("All instance geometries must have the same primitiveType.")}var b,w,g,x,T=function(e,t){var r,i=e.length,a={},n=e[0][t].attributes;for(r in n)if(n.hasOwnProperty(r)&&o.e(n[r])&&o.e(n[r].values)){for(var s=n[r],u=s.values.length,p=!0,v=1;v<i;++v){var c=e[v][t].attributes[r];if(!o.e(c)||s.componentDatatype!==c.componentDatatype||s.componentsPerAttribute!==c.componentsPerAttribute||s.normalize!==c.normalize){p=!1;break}u+=c.values.length}p&&(a[r]=new y.o({componentDatatype:s.componentDatatype,componentsPerAttribute:s.componentsPerAttribute,normalize:s.normalize,values:l.ComponentDatatype.createTypedArray(s.componentDatatype,u)}),s.isInstanceAttribute&&(a[r].isInstanceAttribute=!0))}return a}(e,t);for(r in T)if(T.hasOwnProperty(r))for(b=T[r].values,p=0,n=0;n<v;++n)for(g=(w=e[n][t].attributes[r].values).length,u=0;u<g;++u)b[p++]=w[u];if(f){var A=0;for(n=0;n<v;++n)A+=e[n][t].indices.length;var I=y.I.computeNumberOfVertices(new y.I({attributes:T,primitiveType:d._0x1da42a.POINTS})),S=c.IndexDatatype.createTypedArray(I,A),P=0,N=0;for(n=0;n<v;++n){var E=e[n][t].indices,O=E.length;for(p=0;p<O;++p)S[P++]=N+E[p];N+=y.I.computeNumberOfVertices(e[n][t])}x=S}var L,D=new i.o,z=0;for(n=0;n<v;++n){if(L=e[n][t].boundingSphere,!o.e(L)){D=void 0;break}i.o.add(L.center,D,D)}if(o.e(D))for(i.o.divideByScalar(D,v,D),n=0;n<v;++n){L=e[n][t].boundingSphere;var _=i.o.magnitude(i.o.subtract(L.center,D,C))+L.radius;_>z&&(z=_)}return new y.I({attributes:T,indices:x,primitiveType:h,boundingSphere:o.e(D)?new s.i(D,z):void 0})}A.combineInstances=function(e){if(!o.e(e)||e.length<1)throw new a.t("instances is required and must have length greater than zero.");for(var t=[],r=[],i=e.length,n=0;n<i;++n){var s=e[n];o.e(s.geometry)?t.push(s):o.e(s.westHemisphereGeometry)&&o.e(s.eastHemisphereGeometry)&&r.push(s)}var u=[];return t.length>0&&u.push(R(t,"geometry")),r.length>0&&(u.push(R(r,"westHemisphereGeometry")),u.push(R(r,"eastHemisphereGeometry"))),u};var G=new i.o,F=new i.o,k=new i.o,B=new i.o;A.computeNormal=function(e){if(!o.e(e))throw new a.t("geometry is required.");if(!o.e(e.attributes.position)||!o.e(e.attributes.position.values))throw new a.t("geometry.attributes.position.values is required.");if(!o.e(e.indices))throw new a.t("geometry.indices is required.");if(e.indices.length<2||e.indices.length%3!=0)throw new a.t("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==d._0x1da42a.TRIANGLES)throw new a.t("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var t,r=e.indices,s=e.attributes,u=s.position.values,p=s.position.values.length/3,v=r.length,c=new Array(p),m=new Array(v/3),f=new Array(v);for(t=0;t<p;t++)c[t]={indexOffset:0,count:0,currentCount:0};var h=0;for(t=0;t<v;t+=3){var b=r[t],w=r[t+1],g=r[t+2],x=3*b,T=3*w,A=3*g;F.x=u[x],F.y=u[x+1],F.z=u[x+2],k.x=u[T],k.y=u[T+1],k.z=u[T+2],B.x=u[A],B.y=u[A+1],B.z=u[A+2],c[b].count++,c[w].count++,c[g].count++,i.o.subtract(k,F,k),i.o.subtract(B,F,B),m[h]=i.o.cross(k,B,new i.o),h++}var I,S=0;for(t=0;t<p;t++)c[t].indexOffset+=S,S+=c[t].count;for(h=0,t=0;t<v;t+=3){var P=(I=c[r[t]]).indexOffset+I.currentCount;f[P]=h,I.currentCount++,f[P=(I=c[r[t+1]]).indexOffset+I.currentCount]=h,I.currentCount++,f[P=(I=c[r[t+2]]).indexOffset+I.currentCount]=h,I.currentCount++,h++}var N=new Float32Array(3*p);for(t=0;t<p;t++){var E=3*t;if(I=c[t],i.o.clone(i.o.ZERO,G),I.count>0){for(h=0;h<I.count;h++)i.o.add(G,m[f[I.indexOffset+h]],G);i.o.equalsEpsilon(i.o.ZERO,G,n.e.EPSILON10)&&i.o.clone(m[f[I.indexOffset]],G)}i.o.equalsEpsilon(i.o.ZERO,G,n.e.EPSILON10)&&(G.z=1),i.o.normalize(G,G),N[E]=G.x,N[E+1]=G.y,N[E+2]=G.z}return e.attributes.normal=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:N}),e};var M=new i.o,V=new i.o,U=new i.o;A.computeTangentAndBitangent=function(e){if(!o.e(e))throw new a.t("geometry is required.");var t=e.attributes,r=e.indices;if(!o.e(t.position)||!o.e(t.position.values))throw new a.t("geometry.attributes.position.values is required.");if(!o.e(t.normal)||!o.e(t.normal.values))throw new a.t("geometry.attributes.normal.values is required.");if(!o.e(t.st)||!o.e(t.st.values))throw new a.t("geometry.attributes.st.values is required.");if(!o.e(r))throw new a.t("geometry.indices is required.");if(r.length<2||r.length%3!=0)throw new a.t("geometry.indices length must be greater than 0 and be a multiple of 3.");if(e.primitiveType!==d._0x1da42a.TRIANGLES)throw new a.t("geometry.primitiveType must be PrimitiveType.TRIANGLES.");var n,s,u,p,v=e.attributes.position.values,c=e.attributes.normal.values,m=e.attributes.st.values,f=e.attributes.position.values.length/3,h=r.length,b=new Array(3*f);for(n=0;n<b.length;n++)b[n]=0;for(n=0;n<h;n+=3){var w=r[n],g=r[n+1],x=r[n+2];u=3*g,p=3*x;var T=2*w,A=2*g,I=2*x,S=v[s=3*w],P=v[s+1],N=v[s+2],E=m[T],O=m[T+1],L=m[A+1]-O,D=m[I+1]-O,z=1/((m[A]-E)*D-(m[I]-E)*L),_=(D*(v[u]-S)-L*(v[p]-S))*z,q=(D*(v[u+1]-P)-L*(v[p+1]-P))*z,C=(D*(v[u+2]-N)-L*(v[p+2]-N))*z;b[s]+=_,b[s+1]+=q,b[s+2]+=C,b[u]+=_,b[u+1]+=q,b[u+2]+=C,b[p]+=_,b[p+1]+=q,b[p+2]+=C}var R=new Float32Array(3*f),G=new Float32Array(3*f);for(n=0;n<f;n++){u=(s=3*n)+1,p=s+2;var F=i.o.fromArray(c,s,M),k=i.o.fromArray(b,s,U),B=i.o.dot(F,k);i.o.multiplyByScalar(F,B,V),i.o.normalize(i.o.subtract(k,V,k),k),R[s]=k.x,R[u]=k.y,R[p]=k.z,i.o.normalize(i.o.cross(F,k,k),k),G[s]=k.x,G[u]=k.y,G[p]=k.z}return e.attributes.tangent=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:R}),e.attributes.bitangent=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:3,values:G}),e};var Y=new r.o,Z=new i.o,H=new i.o,W=new i.o,X=new r.o;function j(e){switch(e.primitiveType){case d._0x1da42a.TRIANGLE_FAN:return function(e){var t=y.I.computeNumberOfVertices(e);if(t<3)throw new a.t("The number of vertices must be at least three.");var r=c.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=1,r[1]=0,r[2]=2;for(var i=3,o=3;o<t;++o)r[i++]=o-1,r[i++]=0,r[i++]=o;return e.indices=r,e.primitiveType=d._0x1da42a.TRIANGLES,e}(e);case d._0x1da42a.TRIANGLE_STRIP:return function(e){var t=y.I.computeNumberOfVertices(e);if(t<3)throw new a.t("The number of vertices must be at least 3.");var r=c.IndexDatatype.createTypedArray(t,3*(t-2));r[0]=0,r[1]=1,r[2]=2,t>3&&(r[3]=0,r[4]=2,r[5]=3);for(var i=6,o=3;o<t-1;o+=2)r[i++]=o,r[i++]=o-1,r[i++]=o+1,o+2<t&&(r[i++]=o,r[i++]=o+1,r[i++]=o+2);return e.indices=r,e.primitiveType=d._0x1da42a.TRIANGLES,e}(e);case d._0x1da42a.TRIANGLES:return function(e){if(o.e(e.indices))return e;var t=y.I.computeNumberOfVertices(e);if(t<3)throw new a.t("The number of vertices must be at least three.");if(t%3!=0)throw new a.t("The number of vertices must be a multiple of three.");for(var r=c.IndexDatatype.createTypedArray(t,t),i=0;i<t;++i)r[i]=i;return e.indices=r,e}(e);case d._0x1da42a.LINE_STRIP:return function(e){var t=y.I.computeNumberOfVertices(e);if(t<2)throw new a.t("The number of vertices must be at least two.");var r=c.IndexDatatype.createTypedArray(t,2*(t-1));r[0]=0,r[1]=1;for(var i=2,o=2;o<t;++o)r[i++]=o-1,r[i++]=o;return e.indices=r,e.primitiveType=d._0x1da42a.LINES,e}(e);case d._0x1da42a.LINE_LOOP:return function(e){var t=y.I.computeNumberOfVertices(e);if(t<2)throw new a.t("The number of vertices must be at least two.");var r=c.IndexDatatype.createTypedArray(t,2*t);r[0]=0,r[1]=1;for(var i=2,o=2;o<t;++o)r[i++]=o-1,r[i++]=o;return r[i++]=t-1,r[i]=0,e.indices=r,e.primitiveType=d._0x1da42a.LINES,e}(e);case d._0x1da42a.LINES:return function(e){if(o.e(e.indices))return e;var t=y.I.computeNumberOfVertices(e);if(t<2)throw new a.t("The number of vertices must be at least two.");if(t%2!=0)throw new a.t("The number of vertices must be a multiple of 2.");for(var r=c.IndexDatatype.createTypedArray(t,t),i=0;i<t;++i)r[i]=i;return e.indices=r,e}(e)}return e}function J(e,t){Math.abs(e.y)<n.e.EPSILON6&&(e.y=t?-n.e.EPSILON6:n.e.EPSILON6)}A.compressVertices=function(e){if(!o.e(e))throw new a.t("geometry is required.");var n,s,u=e.attributes.extrudeDirection;if(o.e(u)){var p=u.values;s=p.length/3;var v=new Float32Array(2*s),c=0;for(n=0;n<s;++n)i.o.fromArray(p,3*n,Z),i.o.equals(Z,i.o.ZERO)?c+=2:(X=t.t.octEncodeInRange(Z,65535,X),v[c++]=X.x,v[c++]=X.y);return e.attributes.compressedAttributes=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:2,values:v}),delete e.attributes.extrudeDirection,e}var m=e.attributes.normal,f=e.attributes.st,d=o.e(m),h=o.e(f);if(!d&&!h)return e;var b,w,g,x,T=e.attributes.tangent,A=e.attributes.bitangent,I=o.e(T),S=o.e(A);d&&(b=m.values),h&&(w=f.values),I&&(g=T.values),S&&(x=A.values);var P=s=(d?b.length:w.length)/(d?3:2),N=h&&d?2:1;N+=I||S?1:0;var E=new Float32Array(P*=N),O=0;for(n=0;n<s;++n){h&&(r.o.fromArray(w,2*n,Y),E[O++]=t.t.compressTextureCoordinates(Y));var L=3*n;d&&o.e(g)&&o.e(x)?(i.o.fromArray(b,L,Z),i.o.fromArray(g,L,H),i.o.fromArray(x,L,W),t.t.octPack(Z,H,W,Y),E[O++]=Y.x,E[O++]=Y.y):(d&&(i.o.fromArray(b,L,Z),E[O++]=t.t.octEncodeFloat(Z)),I&&(i.o.fromArray(g,L,Z),E[O++]=t.t.octEncodeFloat(Z)),S&&(i.o.fromArray(x,L,Z),E[O++]=t.t.octEncodeFloat(Z)))}return e.attributes.compressedAttributes=new y.o({componentDatatype:l.ComponentDatatype.FLOAT,componentsPerAttribute:N,values:E}),d&&delete e.attributes.normal,h&&delete e.attributes.st,S&&delete e.attributes.bitangent,I&&delete e.attributes.tangent,e};var K=new i.o;function Q(e,t,r,a){i.o.add(e,i.o.multiplyByScalar(i.o.subtract(t,e,K),e.y/(e.y-t.y),K),r),i.o.clone(r,a),J(r,!0),J(a,!1)}var $=new i.o,ee=new i.o,te=new i.o,re=new i.o,ie={positions:new Array(7),indices:new Array(9)};function ae(e,t,r){if(!(e.x>=0||t.x>=0||r.x>=0)){!function(e,t,r){if(0!==e.y&&0!==t.y&&0!==r.y)return J(e,e.y<0),J(t,t.y<0),void J(r,r.y<0);var i=Math.abs(e.y),a=Math.abs(t.y),o=Math.abs(r.y),s=(i>a?i>o?n.e.sign(e.y):n.e.sign(r.y):a>o?n.e.sign(t.y):n.e.sign(r.y))<0;J(e,s),J(t,s),J(r,s)}(e,t,r);var i=e.y<0,a=t.y<0,o=r.y<0,s=0;s+=i?1:0,s+=a?1:0;var u=ie.indices;1===(s+=o?1:0)?(u[1]=3,u[2]=4,u[5]=6,u[7]=6,u[8]=5,i?(Q(e,t,$,te),Q(e,r,ee,re),u[0]=0,u[3]=1,u[4]=2,u[6]=1):a?(Q(t,r,$,te),Q(t,e,ee,re),u[0]=1,u[3]=2,u[4]=0,u[6]=2):o&&(Q(r,e,$,te),Q(r,t,ee,re),u[0]=2,u[3]=0,u[4]=1,u[6]=0)):2===s&&(u[2]=4,u[4]=4,u[5]=3,u[7]=5,u[8]=6,i?a?o||(Q(r,e,$,te),Q(r,t,ee,re),u[0]=0,u[1]=1,u[3]=0,u[6]=2):(Q(t,r,$,te),Q(t,e,ee,re),u[0]=2,u[1]=0,u[3]=2,u[6]=1):(Q(e,t,$,te),Q(e,r,ee,re),u[0]=1,u[1]=2,u[3]=1,u[6]=0));var p=ie.positions;return p[0]=e,p[1]=t,p[2]=r,p.length=3,(1===s||2===s)&&(p[3]=$,p[4]=ee,p[5]=te,p[6]=re,p.length=7),ie}}function oe(e,t){var r=e.attributes;if(0!==r.position.values.length){for(var i in r)if(r.hasOwnProperty(i)&&o.e(r[i])&&o.e(r[i].values)){var a=r[i];a.values=l.ComponentDatatype.createTypedArray(a.componentDatatype,a.values)}var n=y.I.computeNumberOfVertices(e);return e.indices=c.IndexDatatype.createTypedArray(n,e.indices),t&&(e.boundingSphere=s.i.fromVertices(r.position.values)),e}}function ne(e){var t=e.attributes,r={};for(var i in t)if(t.hasOwnProperty(i)&&o.e(t[i])&&o.e(t[i].values)){var a=t[i];r[i]=new y.o({componentDatatype:a.componentDatatype,componentsPerAttribute:a.componentsPerAttribute,normalize:a.normalize,values:[]})}return new y.I({attributes:r,indices:[],primitiveType:e.primitiveType})}function se(e,t,r){var i=o.e(e.geometry.boundingSphere);t=oe(t,i),r=oe(r,i),o.e(r)&&!o.e(t)?e.geometry=r:!o.e(r)&&o.e(t)?e.geometry=t:(e.westHemisphereGeometry=t,e.eastHemisphereGeometry=r,e.geometry=void 0)}function ue(e,t){var r=new e,i=new e,a=new e;return function(o,n,s,u,p,l,v,y){var c=e.fromArray(p,o*t,r),m=e.fromArray(p,n*t,i),f=e.fromArray(p,s*t,a);e.multiplyByScalar(c,u.x,c),e.multiplyByScalar(m,u.y,m),e.multiplyByScalar(f,u.z,f);var d=e.add(c,m,c);e.add(d,f,d),y&&e.normalize(d,d),e.pack(d,l,v*t)}}var pe=ue(u.e,4),le=ue(i.o,3),ve=ue(r.o,2),ye=new i.o,ce=new i.o,me=new i.o,fe=new i.o;function de(e,t,r,a,s,u,p,l,v,y,c,m,f,d,h,b){if(o.e(u)||o.e(p)||o.e(l)||o.e(v)||o.e(y)||0!==d){var w=x(a,i.o.fromArray(s,3*e,ye),i.o.fromArray(s,3*t,ce),i.o.fromArray(s,3*r,me),fe);if(o.e(u)&&le(e,t,r,w,u,m.normal.values,b,!0),o.e(y)){var g,T=i.o.fromArray(y,3*e,ye),A=i.o.fromArray(y,3*t,ce),I=i.o.fromArray(y,3*r,me);i.o.multiplyByScalar(T,w.x,T),i.o.multiplyByScalar(A,w.y,A),i.o.multiplyByScalar(I,w.z,I),i.o.equals(T,i.o.ZERO)&&i.o.equals(A,i.o.ZERO)&&i.o.equals(I,i.o.ZERO)?((g=ye).x=0,g.y=0,g.z=0):(g=i.o.add(T,A,T),i.o.add(g,I,g),i.o.normalize(g,g)),i.o.pack(g,m.extrudeDirection.values,3*b)}if(o.e(c)&&function(e,t,r,i,a,o,s){var u=a[e]*i.x,p=a[t]*i.y,l=a[r]*i.z;o[s]=u+p+l>n.e.EPSILON6?1:0}(e,t,r,w,c,m.applyOffset.values,b),o.e(p)&&le(e,t,r,w,p,m.tangent.values,b,!0),o.e(l)&&le(e,t,r,w,l,m.bitangent.values,b,!0),o.e(v)&&ve(e,t,r,w,v,m.st.values,b),d>0)for(var S=0;S<d;S++){var P=f[S];he(e,t,r,w,b,h[P],m[P])}}}function he(e,t,r,i,a,o,n){var s=o.componentsPerAttribute,u=o.values,p=n.values;switch(s){case 4:pe(e,t,r,i,u,p,a,!1);break;case 3:le(e,t,r,i,u,p,a,!1);break;case 2:ve(e,t,r,i,u,p,a,!1);break;default:p[a]=u[e]*i.x+u[t]*i.y+u[r]*i.z}}function be(e,t,r,i,a,o){var n=e.position.values.length/3;if(-1!==a){var s=i[a],u=r[s];return-1===u?(r[s]=n,e.position.values.push(o.x,o.y,o.z),t.push(n),n):(t.push(u),u)}return e.position.values.push(o.x,o.y,o.z),t.push(n),n}var we={position:!0,normal:!0,bitangent:!0,tangent:!0,st:!0,extrudeDirection:!0,applyOffset:!0};function ge(e){var t=e.geometry,r=t.attributes,a=r.position.values,n=o.e(r.normal)?r.normal.values:void 0,s=o.e(r.bitangent)?r.bitangent.values:void 0,u=o.e(r.tangent)?r.tangent.values:void 0,p=o.e(r.st)?r.st.values:void 0,l=o.e(r.extrudeDirection)?r.extrudeDirection.values:void 0,v=o.e(r.applyOffset)?r.applyOffset.values:void 0,y=t.indices,c=[];for(var m in r)r.hasOwnProperty(m)&&!we[m]&&o.e(r[m])&&c.push(m);var f,d,h,b,w=c.length,g=ne(t),x=ne(t),T=[];T.length=a.length/3;var A=[];for(A.length=a.length/3,b=0;b<T.length;++b)T[b]=-1,A[b]=-1;var I=y.length;for(b=0;b<I;b+=3){var S=y[b],P=y[b+1],N=y[b+2],E=i.o.fromArray(a,3*S),O=i.o.fromArray(a,3*P),L=i.o.fromArray(a,3*N),D=ae(E,O,L);if(o.e(D)&&D.positions.length>3)for(var z=D.positions,_=D.indices,q=_.length,C=0;C<q;++C){var R=_[C],G=z[R];G.y<0?(f=x.attributes,d=x.indices,h=T):(f=g.attributes,d=g.indices,h=A),de(S,P,N,G,a,n,u,s,p,l,v,f,c,w,r,be(f,d,h,y,R<3?b+R:-1,G))}else o.e(D)&&(E=D.positions[0],O=D.positions[1],L=D.positions[2]),E.y<0?(f=x.attributes,d=x.indices,h=T):(f=g.attributes,d=g.indices,h=A),de(S,P,N,E,a,n,u,s,p,l,v,f,c,w,r,be(f,d,h,y,b,E)),de(S,P,N,O,a,n,u,s,p,l,v,f,c,w,r,be(f,d,h,y,b+1,O)),de(S,P,N,L,a,n,u,s,p,l,v,f,c,w,r,be(f,d,h,y,b+2,L))}se(e,x,g)}var xe=h.o.fromPointNormal(i.o.ZERO,i.o.UNIT_Y),Te=new i.o,Ae=new i.o;function Ie(e,t,r,a,s,u,p){if(o.e(p)){var l=i.o.fromArray(a,3*e,ye);i.o.equalsEpsilon(l,r,n.e.EPSILON10)?u.applyOffset.values[s]=p[e]:u.applyOffset.values[s]=p[t]}}function Se(e){var t,r=e.geometry,a=r.attributes,s=a.position.values,u=o.e(a.applyOffset)?a.applyOffset.values:void 0,p=r.indices,l=ne(r),v=ne(r),y=p.length,c=[];c.length=s.length/3;var f=[];for(f.length=s.length/3,t=0;t<c.length;++t)c[t]=-1,f[t]=-1;for(t=0;t<y;t+=2){var d=p[t],h=p[t+1],b=i.o.fromArray(s,3*d,ye),w=i.o.fromArray(s,3*h,ce);Math.abs(b.y)<n.e.EPSILON6&&(b.y<0?b.y=-n.e.EPSILON6:b.y=n.e.EPSILON6),Math.abs(w.y)<n.e.EPSILON6&&(w.y<0?w.y=-n.e.EPSILON6:w.y=n.e.EPSILON6);var g=l.attributes,x=l.indices,T=f,A=v.attributes,I=v.indices,S=c,P=m.g.lineSegmentPlane(b,w,xe,me);if(o.e(P)){var N=i.o.multiplyByScalar(i.o.UNIT_Y,5*n.e.EPSILON9,Te);b.y<0&&(i.o.negate(N,N),g=v.attributes,x=v.indices,T=c,A=l.attributes,I=l.indices,S=f);var E=i.o.add(P,N,Ae);Ie(d,h,b,s,be(g,x,T,p,t,b),g,u),Ie(d,h,E,s,be(g,x,T,p,-1,E),g,u),i.o.negate(N,N),i.o.add(P,N,E),Ie(d,h,E,s,be(A,I,S,p,-1,E),A,u),Ie(d,h,w,s,be(A,I,S,p,t+1,w),A,u)}else{var O,L,D;b.y<0?(O=v.attributes,L=v.indices,D=c):(O=l.attributes,L=l.indices,D=f),Ie(d,h,b,s,be(O,L,D,p,t,b),O,u),Ie(d,h,w,s,be(O,L,D,p,t+1,w),O,u)}}se(e,v,l)}var Pe=new r.o,Ne=new r.o,Ee=new i.o,Oe=new i.o,Le=new i.o,De=new i.o,ze=new i.o,_e=new i.o,qe=new i.o,Ce=new u.e;function Re(e){for(var t=e.attributes,r=t.position.values,a=t.prevPosition.values,o=t.nextPosition.values,n=r.length,s=0;s<n;s+=3){var u=i.o.unpack(r,s,Ee);if(!(u.x>0)){var p=i.o.unpack(a,s,Oe);(u.y<0&&p.y>0||u.y>0&&p.y<0)&&(s-3>0?(a[s]=r[s-3],a[s+1]=r[s-2],a[s+2]=r[s-1]):i.o.pack(u,a,s));var l=i.o.unpack(o,s,Le);(u.y<0&&l.y>0||u.y>0&&l.y<0)&&(s+3<n?(o[s]=r[s+3],o[s+1]=r[s+4],o[s+2]=r[s+5]):i.o.pack(u,o,s))}}}var Ge=5*n.e.EPSILON9,Fe=n.e.EPSILON6;A.splitLongitude=function(e){if(!o.e(e))throw new a.t("instance is required.");var t=e.geometry,p=t.boundingSphere;if(o.e(p)&&(p.center.x-p.radius>0||s.i.intersectPlane(p,h.o.ORIGIN_ZX_PLANE)!==s.S.INTERSECTING))return e;if(t.geometryType!==y.Me.NONE)switch(t.geometryType){case y.Me.POLYLINES:!function(e){var t,a,s,p=e.geometry,l=p.attributes,v=l.position.values,y=l.prevPosition.values,c=l.nextPosition.values,f=l.expandAndWidth.values,d=o.e(l.st)?l.st.values:void 0,h=o.e(l.color)?l.color.values:void 0,b=o.e(l.dist)?l.dist.values:void 0,w=ne(p),g=ne(p),x=!1,T=v.length/3;for(t=0;t<T;t+=4){var A=t,I=t+2,S=i.o.fromArray(v,3*A,Ee),P=i.o.fromArray(v,3*I,Oe);if(Math.abs(S.y)<Fe)for(S.y=Fe*(P.y<0?-1:1),v[3*t+1]=S.y,v[3*(t+1)+1]=S.y,a=3*A;a<3*A+12;a+=3)y[a]=v[3*t],y[a+1]=v[3*t+1],y[a+2]=v[3*t+2];if(Math.abs(P.y)<Fe)for(P.y=Fe*(S.y<0?-1:1),v[3*(t+2)+1]=P.y,v[3*(t+3)+1]=P.y,a=3*A;a<3*A+12;a+=3)c[a]=v[3*(t+2)],c[a+1]=v[3*(t+2)+1],c[a+2]=v[3*(t+2)+2];var N=w.attributes,E=w.indices,O=g.attributes,L=g.indices,D=m.g.lineSegmentPlane(S,P,xe,De);if(o.e(D)){x=!0;var z=i.o.multiplyByScalar(i.o.UNIT_Y,Ge,ze);S.y<0&&(i.o.negate(z,z),N=g.attributes,E=g.indices,O=w.attributes,L=w.indices);var _=i.o.add(D,z,_e);N.position.values.push(S.x,S.y,S.z,S.x,S.y,S.z),N.position.values.push(_.x,_.y,_.z),N.position.values.push(_.x,_.y,_.z),N.prevPosition.values.push(y[3*A],y[3*A+1],y[3*A+2]),N.prevPosition.values.push(y[3*A+3],y[3*A+4],y[3*A+5]),N.prevPosition.values.push(S.x,S.y,S.z,S.x,S.y,S.z),N.nextPosition.values.push(_.x,_.y,_.z),N.nextPosition.values.push(_.x,_.y,_.z),N.nextPosition.values.push(_.x,_.y,_.z),N.nextPosition.values.push(_.x,_.y,_.z),i.o.negate(z,z),i.o.add(D,z,_),O.position.values.push(_.x,_.y,_.z),O.position.values.push(_.x,_.y,_.z),O.position.values.push(P.x,P.y,P.z,P.x,P.y,P.z),O.prevPosition.values.push(_.x,_.y,_.z),O.prevPosition.values.push(_.x,_.y,_.z),O.prevPosition.values.push(_.x,_.y,_.z),O.prevPosition.values.push(_.x,_.y,_.z),O.nextPosition.values.push(P.x,P.y,P.z,P.x,P.y,P.z),O.nextPosition.values.push(c[3*I],c[3*I+1],c[3*I+2]),O.nextPosition.values.push(c[3*I+3],c[3*I+4],c[3*I+5]);var q=r.o.fromArray(f,2*A,Pe),C=Math.abs(q.y);N.expandAndWidth.values.push(-1,C,1,C),N.expandAndWidth.values.push(-1,-C,1,-C),O.expandAndWidth.values.push(-1,C,1,C),O.expandAndWidth.values.push(-1,-C,1,-C);var R=i.o.magnitudeSquared(i.o.subtract(D,S,Le));if(R/=i.o.magnitudeSquared(i.o.subtract(P,S,Le)),o.e(h)){var G=u.e.fromArray(h,4*A,Ce),F=u.e.fromArray(h,4*I,Ce),k=n.e.lerp(G.x,F.x,R),B=n.e.lerp(G.y,F.y,R),M=n.e.lerp(G.z,F.z,R),V=n.e.lerp(G.w,F.w,R);for(a=4*A;a<4*A+8;++a)N.color.values.push(h[a]);for(N.color.values.push(k,B,M,V),N.color.values.push(k,B,M,V),O.color.values.push(k,B,M,V),O.color.values.push(k,B,M,V),a=4*I;a<4*I+8;++a)O.color.values.push(h[a])}if(o.e(d)){var U=r.o.fromArray(d,2*A,Pe),Y=r.o.fromArray(d,2*(t+3),Ne),Z=n.e.lerp(U.x,Y.x,R);for(a=2*A;a<2*A+4;++a)N.st.values.push(d[a]);for(N.st.values.push(Z,U.y),N.st.values.push(Z,Y.y),O.st.values.push(Z,U.y),O.st.values.push(Z,Y.y),a=2*I;a<2*I+4;++a)O.st.values.push(d[a])}if(o.e(b)){var H=i.o.fromArray(b,3*A,qe),W=i.o.fromArray(b,3*I,qe),X=n.e.lerp(H.x,W.x,R);for(a=3*A;a<3*A+6;++a)N.dist.values.push(b[a]);for(N.dist.values.push(X,H.y,H.z),N.dist.values.push(X,H.y,H.z),O.dist.values.push(X,W.y,W.z),O.dist.values.push(X,W.y,W.z),a=3*I;a<3*I+6;++a)O.dist.values.push(b[a])}s=N.position.values.length/3-4,E.push(s,s+2,s+1),E.push(s+1,s+2,s+3),s=O.position.values.length/3-4,L.push(s,s+2,s+1),L.push(s+1,s+2,s+3)}else{var j,J;for(S.y<0?(j=g.attributes,J=g.indices):(j=w.attributes,J=w.indices),j.position.values.push(S.x,S.y,S.z),j.position.values.push(S.x,S.y,S.z),j.position.values.push(P.x,P.y,P.z),j.position.values.push(P.x,P.y,P.z),a=3*t;a<3*t+12;++a)j.prevPosition.values.push(y[a]),j.nextPosition.values.push(c[a]);for(a=2*t;a<2*t+8;++a)j.expandAndWidth.values.push(f[a]),o.e(d)&&j.st.values.push(d[a]);if(o.e(h))for(a=4*t;a<4*t+16;++a)j.color.values.push(h[a]);if(o.e(b))for(a=3*t;a<3*t+12;++a)j.dist.values.push(b[a]);s=j.position.values.length/3-4,J.push(s,s+2,s+1),J.push(s+1,s+2,s+3)}}x&&(Re(g),Re(w)),se(e,g,w)}(e);break;case y.Me.TRIANGLES:ge(e);break;case y.Me.LINES:Se(e)}else j(t),t.primitiveType===d._0x1da42a.TRIANGLES?ge(e):t.primitiveType===d._0x1da42a.LINES&&Se(e);return e},e.k=A}));
