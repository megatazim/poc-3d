define(["./buildModuleUrl-89a61082","./BoxGeometry-5fdc61ce","./Cartesian3-6ab6e817","./Color-7716e146","./CylinderGeometry-9b0a5e07","./defaultValue-6195d6e4","./EllipsoidGeometry-57704ed4","./IndexDatatype-7f829734","./PrimitiveType-5db31a9b","./createTaskProcessorWorker","./Cartographic-84b54204","./Check-d771f3f9","./Math-77022010","./Ellipsoid-9d24693d","./FeatureDetection-d5e675a3","./defer-a21481c0","./Rectangle-f1a1bbf0","./Event-8b63693e","./RuntimeError-3afc2b48","./arrayFill-6162b951","./ComponentDatatype-9e683007","./WebGLConstants-92042d9e","./GeometryAttribute-b7129781","./Cartesian4-da892aa1","./GeometryAttributes-bc1c2f3f","./GeometryOffsetAttribute-da5a1d35","./VertexFormat-8dc15345","./CylinderGeometryLibrary-ed5f56cf"],(function(e,t,n,r,a,o,i,d,s,c,l,f,u,h,b,y,p,v,g,m,x,I,k,w,A,B,O,C){"use strict";function L(e){this.offset=e.offset,this.count=e.count,this.color=e.color,this.batchIds=e.batchIds}var E=new n.o,U=s.y.packedLength+n.o.packedLength,M=s.y.packedLength+2,F=s.y.packedLength+n.o.packedLength,V=n.o.packedLength+1,T={modelMatrix:new s.y,boundingVolume:new e.i};function G(e,t){var r=t*U,a=n.o.unpack(e,r,E);r+=n.o.packedLength;var o=s.y.unpack(e,r,T.modelMatrix);s.y.multiplyByScale(o,a,o);var i=T.boundingVolume;return n.o.clone(n.o.ZERO,i.center),i.radius=Math.sqrt(3),T}function R(e,t){var r=t*M,a=e[r++],o=e[r++],i=n.o.fromElements(a,a,o,E),d=s.y.unpack(e,r,T.modelMatrix);s.y.multiplyByScale(d,i,d);var c=T.boundingVolume;return n.o.clone(n.o.ZERO,c.center),c.radius=Math.sqrt(2),T}function S(e,t){var r=t*F,a=n.o.unpack(e,r,E);r+=n.o.packedLength;var o=s.y.unpack(e,r,T.modelMatrix);s.y.multiplyByScale(o,a,o);var i=T.boundingVolume;return n.o.clone(n.o.ZERO,i.center),i.radius=1,T}function D(e,t){var r=t*V,a=e[r++],o=n.o.unpack(e,r,E),i=s.y.fromTranslation(o,T.modelMatrix);s.y.multiplyByUniformScale(i,a,i);var d=T.boundingVolume;return n.o.clone(n.o.ZERO,d.center),d.radius=1,T}var P=new n.o;function Z(t,a,i,d,c){if(o.e(a)){for(var l=i.length,f=d.attributes.position.values,u=d.indices,h=t.positions,b=t.vertexBatchIds,y=t.indices,p=t.batchIds,v=t.batchTableColors,g=t.batchedIndices,m=t.indexOffsets,x=t.indexCounts,I=t.boundingVolumes,k=t.modelMatrix,w=t.center,A=t.positionOffset,B=t.batchIdIndex,O=t.indexOffset,C=t.batchedIndicesOffset,E=0;E<l;++E){var U=c(a,E),M=U.modelMatrix;s.y.multiply(k,M,M);for(var F=i[E],V=f.length,T=0;T<V;T+=3){var G=n.o.unpack(f,T,P);s.y.multiplyByPoint(M,G,G),n.o.subtract(G,w,G),n.o.pack(G,h,3*A+T),b[B++]=F}for(var R=u.length,S=0;S<R;++S)y[O+S]=u[S]+A;var D=E+C;g[D]=new L({offset:O,count:R,color:r.e.fromRgba(v[F]),batchIds:[F]}),p[D]=F,m[D]=O,x[D]=R,I[D]=e.i.transform(U.boundingVolume,M),A+=V/3,O+=R}t.positionOffset=A,t.batchIdIndex=B,t.indexOffset=O,t.batchedIndicesOffset+=l}}var q=new n.o,W=new s.y;function _(t,n,a){var o=a.length,i=2+o*e.i.packedLength+1+function(e){for(var t=e.length,n=0,a=0;a<t;++a)n+=r.e.packedLength+3+e[a].batchIds.length;return n}(n),d=new Float64Array(i),s=0;d[s++]=t,d[s++]=o;for(var c=0;c<o;++c)e.i.pack(a[c],d,s),s+=e.i.packedLength;var l=n.length;d[s++]=l;for(var f=0;f<l;++f){var u=n[f];r.e.pack(u.color,d,s),s+=r.e.packedLength,d[s++]=u.offset,d[s++]=u.count;var h=u.batchIds,b=h.length;d[s++]=b;for(var y=0;y<b;++y)d[s++]=h[y]}return d}return c((function(e,r){var c=o.e(e.boxes)?new Float32Array(e.boxes):void 0,l=o.e(e.boxBatchIds)?new Uint16Array(e.boxBatchIds):void 0,f=o.e(e.cylinders)?new Float32Array(e.cylinders):void 0,u=o.e(e.cylinderBatchIds)?new Uint16Array(e.cylinderBatchIds):void 0,h=o.e(e.ellipsoids)?new Float32Array(e.ellipsoids):void 0,b=o.e(e.ellipsoidBatchIds)?new Uint16Array(e.ellipsoidBatchIds):void 0,y=o.e(e.spheres)?new Float32Array(e.spheres):void 0,p=o.e(e.sphereBatchIds)?new Uint16Array(e.sphereBatchIds):void 0,v=o.e(c)?l.length:0,g=o.e(f)?u.length:0,m=o.e(h)?b.length:0,x=o.e(y)?p.length:0,I=t.O.getUnitBox(),k=a.l.getUnitCylinder(),w=i.b.getUnitEllipsoid(),A=I.attributes.position.values,B=k.attributes.position.values,O=w.attributes.position.values,C=A.length*v;C+=B.length*g,C+=O.length*(m+x);var L=I.indices,E=k.indices,U=w.indices,M=L.length*v;M+=E.length*g,M+=U.length*(m+x);var F=new Float32Array(C),V=new Uint16Array(C/3),T=d.IndexDatatype.createTypedArray(C/3,M),P=v+g+m+x,N=new Uint16Array(P),Y=new Array(P),j=new Uint32Array(P),z=new Uint32Array(P),H=new Array(P);!function(e){var t=new Float64Array(e),r=0;n.o.unpack(t,r,q),r+=n.o.packedLength,s.y.unpack(t,r,W)}(e.packedBuffer);var J={batchTableColors:new Uint32Array(e.batchTableColors),positions:F,vertexBatchIds:V,indices:T,batchIds:N,batchedIndices:Y,indexOffsets:j,indexCounts:z,boundingVolumes:H,positionOffset:0,batchIdIndex:0,indexOffset:0,batchedIndicesOffset:0,modelMatrix:W,center:q};Z(J,c,l,I,G),Z(J,f,u,k,R),Z(J,h,b,w,S),Z(J,y,p,w,D);var K=_(T.BYTES_PER_ELEMENT,Y,H);return r.push(F.buffer,V.buffer,T.buffer),r.push(N.buffer,j.buffer,z.buffer),r.push(K.buffer),{positions:F.buffer,vertexBatchIds:V.buffer,indices:T.buffer,indexOffsets:j.buffer,indexCounts:z.buffer,batchIds:N.buffer,packedBuffer:K.buffer}}))}));
